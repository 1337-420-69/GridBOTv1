// -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
// -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

const fs = require("fs");
const axios = require("axios");
const crypto = require("crypto");

var { param_symbol } = require("./json_param_input.json")
const { api_key, secret } = require("./json_config.json")

// -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

var order_id_list = [];

// -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

var line = "--------------------------------------------------------------------------------";
var line2 = "- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -";
var line3 = "________________________________________________________________________________";

// -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

function contaBinanceCheckUserTrades(symbol, limit){
	var burl = "https://fapi.binance.com";
	var end_point = "/fapi/v1/userTrades";
	var data_query_string = `symbol=${symbol}&limit=${limit}&timestamp=` + Date.now();
	var signature = crypto.createHmac('sha256', secret).update(data_query_string).digest('hex');
	return axios.get(`${burl}${end_point}?${data_query_string}&signature=${signature}`, {headers: {"X-MBX-APIKEY": api_key}});
};

// -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

function autoWriteOrdersList(content) {
	fs.writeFile("./txt_order_list.txt", content, (err) => {
		if (err)
			throw err;
		console.log('The file has been saved!');
	});
};

// -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

console.log(" ");
console.log(line);

// -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
// GET MARKET PRICE

market_data = contaBinanceCheckUserTrades(param_symbol, 20);
market_data.then(function(value){

	console.log(value.data);

	value.data.forEach(function(d_value, d_index, d_array) {

		//console.log(d_value.orderId);
		order_id_list.push(d_value.orderId);
		
	});

	console.log(order_id_list);
	autoWriteOrdersList(order_id_list);

});

// -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
// -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
// -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//